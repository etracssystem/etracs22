import com.rameses.annotations.*;


public class CTCReportService
{
	@PersistenceContext("main")
	def em;
	
	@ProxyMethod
	public def generateAbstractCTCIndividual( rem  ) {
		def list = em.sqlContext.createNamedQuery('ctcreport:getAbstractCTCIndividual')
					.setParameter('objid', rem.objid)
					.resultList.each{
						def tax = em.serializer.read(it.extended).tax
						tax.basic = ( tax.basic == null || it.voided == 1 ? 0.0 : tax.basic )
						tax.business = ( tax.business == null || it.voided == 1 ? 0.0 : tax.business )
						tax.salary = ( tax.salary == null || it.voided == 1 ? 0.0 : tax.salary )
						tax.property = ( tax.property == null || it.voided == 1 ? 0.0 : tax.property )
						tax.interest = ( tax.interest == null || it.voided == 1 ? 0.0 : tax.interest )

						it.extended = [:]
						it.putAll( tax )
						it.additional = tax.salary + tax.business + tax.property 
						it.penalty = tax.interest	
						it.total = it.amount 
					}
		if( ! list ) throw new Exception('No records found.')
		return list 
	}

}
